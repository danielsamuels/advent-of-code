import pytest

from solution import Day, compute, storage

test_data = """
???.### 1,1,3
.??..??...?##. 1,1,3
?#?#?#?#?#?#?#? 1,3,1,6
????.#...#... 4,1,1
????.######..#####. 1,6,5
?###???????? 3,2,1
""".strip()


def test_run_step_1():
    assert Day(test_data).run_step_1() == 21


@pytest.mark.parametrize('row, groups, expected_result', [
    ['???.###', [1, 1, 3], 1],
    ['.??..??...?##.', [1, 1, 3], 4],
    ['?#?#?#?#?#?#?#?', [1, 3, 1, 6], 1],
    ['????.#...#...', [4, 1, 1], 1],
    ['????.######..#####.', [1, 6, 5], 4],
    ['?###????????', [3, 2, 1], 10],
    ['??????#?#?#??', [2, 6], 7],
    ['??????#?#?#??', [2, 2, 6], 1],
    ['#?????????#????', [1, 3, 2, 2], 17],
    ['#??????#???##??#????', [2, 1, 3, 9], 10],
    ['??..#????#????##.??', [2, 3, 2, 1, 2, 1], 6],
    ['#.?.?##????#????.?.', [1, 1, 3, 3, 1, 1], 14],

])
def test_compute(row, groups, expected_result):
    storage.clear()
    results = compute(row, 0, tuple(groups), 0, 0)
    assert results == expected_result, results


def test_run_step_2():
    assert Day(test_data).run_step_2() == 525152
